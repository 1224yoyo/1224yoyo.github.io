<!DOCTYPE html>
<html>
<script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.js"></script>
<script src="https://cdn.jsdelivr.net/npm/phaser3-rex-plugins/dist/rexvirtualjoystickplugin.min.js"></script>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <style>
    html body {
        overflow: hidden;
        margin: 0;               
        touch-action: none;        
      }

    
    

  </style>

</head>

<body>

  
  

</body>

<script>
  let list=[];
  let kill=[];
  let speed=20;
  let i=0;
  
  

  const config = {
  type: Phaser.AUTO,       // 自動選擇 WebGL 或 Canvas
  width:window.innerWidth,              // 遊戲畫面的寬
  height:window.innerHeight,             // 高
  backgroundColor: '#1e90ff', // 背景顏色
  scene: { preload, create, update } // 指定這三個函式

  
  };  
  const game = new Phaser.Game(config);

  //碰撞
  function inthere(a, b) {
  if (!a || !b) return false;
  const aBounds = a.getBounds();
  const bBounds = b.getBounds();
  return Phaser.Geom.Intersects.RectangleToRectangle(aBounds, bBounds);
}

  function preload() {
  console.log("preload(): 載入遊戲資源（例如圖片、音效）");
  };

  function create() {
    

    this.add.rectangle(500,500,50,50,0x00ff00)

    this.news = function(x, y) {
        let rect = this.add.rectangle(x, y, 70, 70, 0xff0000);
        kill.push(rect);
    }

    this.fire=()=>{
      let x=500
      let y=500
      let gun=this.add.rectangle(x,y,15,30,0x00ff00)
      list[i++]=gun
      
    };
    setInterval(this.fire,0.3*1000)};
    

    
  
  

  
  function update() {
    wx = window.innerWidth;
    wy = window.innerHeight;

    // 生成敵人
    if(kill.length < 5) {
        this.news(Math.floor(Math.random() * (wx-100)) + 50, 200);
    }

    // 移動敵人
    for(let kIndex = kill.length - 1; kIndex >= 0; kIndex--) {
        let k = kill[kIndex];
        if(k){
          if(k.y+1<window.innerHeight){k.y += 1}else{k.destroy();kill.splice(kIndex, 1)}};  // 確保 k 不為 undefined
    }

    // 移動子彈
    for(let pIndex = list.length - 1; pIndex >= 0; pIndex--) {
        let p = list[pIndex];
        if(p){if
          (p.y-3>0){p.y -= 3}else{p.destroy();list.splice(pIndex, 1)}};  // 確保 p 不為 undefined
    }

    // 檢查碰撞
    for(let kIndex = kill.length - 1; kIndex >= 0; kIndex--) {
        let k = kill[kIndex];
        if(!k) continue;
        for(let pIndex = list.length - 1; pIndex >= 0; pIndex--) {
            let p = list[pIndex];
            if(!p) continue;

            if(inthere(k, p)) {
                k.destroy();
                p.destroy();
                kill.splice(kIndex, 1);
                list.splice(pIndex, 1);
                break; // 已刪除 k，跳出子彈迴圈
            }
        }
    }
}



</script>


</html>


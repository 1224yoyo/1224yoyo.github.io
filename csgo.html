<!DOCTYPE html>
<html>
<script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.js"></script>
<script src="https://cdn.jsdelivr.net/npm/phaser3-rex-plugins/dist/rexvirtualjoystickplugin.min.js"></script>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <style>
    html,body {
        overflow: hidden;
        margin: 0;               
        touch-action: none;
        padding: 0;        
      }
      #startDiv{
            position: absolute;
            width: 100%;
            height: 100%;
            background: #484747;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-family: Arial;
            flex-direction: column;
        }

        #startbutton{
            padding: 20px 40px;
            font-size: 24px;
            cursor: pointer;
        }
    
    

  </style>

</head>

<body>
  <div id="startDiv">
        <h1>我的射擊遊戲</h1>
        <button id="startbutton">開始遊戲</button>
    </div>
  
  

</body>

<script>
  document.getElementById("startbutton").addEventListener('click',()=>{
        document.getElementById('startDiv').style.display = 'none';
        const game = new Phaser.Game(config);
    })
  score=0
  const speed=5
  let list=[];
  let kill=[];
  let i=0;
  x=500;y=500
  

  const config = {
    type: Phaser.AUTO,
    width: window.innerWidth,
    height: window.innerHeight,
    backgroundColor: '#1e90ff',
    scene: { preload, create, update },
    plugins: {global: [{ key: 'rexVirtualJoystick', plugin: rexvirtualjoystickplugin, start: true }]}
};

  

  //碰撞
  function inthere(a, b) {
  if (!a || !b) return false;
  const aBounds = a.getBounds();
  const bBounds = b.getBounds();
  return Phaser.Geom.Intersects.RectangleToRectangle(aBounds, bBounds);
}

  function preload() {
  this.load.image('player', 'https://i.postimg.cc/SRHp2t07/fei-chuan-de-ping-mian-tu-yong-yu-da-fei-chuan-you-xi-removebg-preview.png');
  //this.load.image('')
  };

  function create() {
    
    this.keys = this.input.keyboard.addKeys("W,A,S,D");
    player = this.add.sprite(500, 500, 'player');
    player.setDisplaySize(100, 100); // 可選，調整大小

    this.news = function(x, y) {
        let rect = this.add.rectangle(x, y, 70, 70, 0xff0000);
        kill.push(rect);
    }

    this.fire=()=>{
      let gun=this.add.rectangle(x+28,y-50,5,10,0xFFFF00)
      list[i++]=gun
      let guns=this.add.rectangle(x-28,y-50,5,10,0xFFFF00)
      list[i++]=guns
    }
    setInterval(this.fire,0.15*1000)
    
    this.joystick = this.plugins.get('rexVirtualJoystick').add(this, {
    x: 100,
    y: window.innerHeight - 100,
    radius: 50,
    base: this.add.circle(0, 0, 50, 0x888888),
    thumb: this.add.circle(0, 0, 25, 0xcccccc)
})}

    


    

    
  
  

  
  function update() {
    
    let cursorKeys = this.joystick.createCursorKeys();
    wx = window.innerWidth;
    wy = window.innerHeight;

    // 生成敵人
    if(kill.length < 5) {
        this.news(Math.floor(Math.random() * (wx-100)) + 50, 200);
    }
    //移動玩家
    if (cursorKeys.left.isDown && x-speed>0){x-=speed}
    if (cursorKeys.right.isDown && x+speed<wx){x+=speed}
    if (cursorKeys.up.isDown && y>0){y-=speed}
    if (cursorKeys.down.isDown &&y<wy){y+=speed}
    player.x=x;player.y=y
    // 移動敵人
    for(let kIndex = kill.length - 1; kIndex >= 0; kIndex--) {
        let k = kill[kIndex];
        if(k){
          if(k.y+1<window.innerHeight){k.y += 1}else{k.destroy();kill.splice(kIndex, 1)}};  // 確保 k 不為 undefined
    }

    // 移動子彈
    for(let pIndex = list.length - 1; pIndex >= 0; pIndex--) {
        let p = list[pIndex];
        if(p){if
          (p.y-3>0){p.y -= 3}else{p.destroy();list.splice(pIndex, 1)}};  // 確保 p 不為 undefined
    }

    // 檢查碰撞
    for(let kIndex = kill.length - 1; kIndex >= 0; kIndex--) {
        let k = kill[kIndex];
        if(!k) continue;
        for(let pIndex = list.length - 1; pIndex >= 0; pIndex--) {
            let p = list[pIndex];
            if(!p) continue;

            if(inthere(k, p)) {
                k.destroy();
                p.destroy();
                kill.splice(kIndex, 1);
                list.splice(pIndex, 1);
                break; // 已刪除 k，跳出子彈迴圈
            }
        }
    }
}



</script>


</html>

